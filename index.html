<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>éŠæˆ²å‚·å®³è¨ˆç®—å™¨</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #121212;
      color: #f1f1f1;
    }
    .fixed-bottom-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: #1f1f1f;
      border-top: 1px solid #333;
      padding: 1rem;
      z-index: 1030;
    }
    input.form-control {
      background-color: #2a2a2a;
      color: #fff;
      border: 1px solid #444;
    }
  </style>
</head>
<body>
<div class="container py-4">
  <h1 class="text-center mb-4">ğŸ§® éŠæˆ²å‚·å®³è¨ˆç®—å™¨</h1>

  <form id="damageForm">
    <div class="row mb-3">
      <div class="col-md-6">
        <label for="panelDamage" class="form-label">äººç‰©é¢æ¿å‚·å®³</label>
        <input type="number" class="form-control" id="panelDamage" value="74058">
      </div>
      <div class="col-md-6">
        <label for="skillLevel" class="form-label">æŠ€èƒ½ç­‰ç´š</label>
        <input type="number" class="form-control" id="skillLevel" value="75">
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-6">
        <label for="skillPanel" class="form-label">æŠ€èƒ½é¢æ¿å‚·å®³</label>
        <input type="number" class="form-control" id="skillPanel" value="75555">
      </div>
      <div class="col-md-6">
        <label for="baseSkillDamage" class="form-label">åŸºç¤æŠ€èƒ½å‚·å®³</label>
        <input type="number" class="form-control" id="baseSkillDamage" readonly>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-6">
        <label for="damagePercent" class="form-label">å‚·å®³%</label>
        <input type="number" class="form-control" id="damagePercent" value="100">
      </div>
      <div class="col-md-6">
        <label for="skillDamagePercent" class="form-label">æŠ€èƒ½å‚·å®³%</label>
        <input type="number" class="form-control" id="skillDamagePercent" value="100">
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-6">
        <label for="extraDamage" class="form-label">æŠ€å‚·%</label>
        <input type="number" class="form-control" id="extraDamage" value="0">
      </div>
      <div class="col-md-6">
        <label for="elementDamage" class="form-label">å±¬å‚·%</label>
        <input type="number" class="form-control" id="elementDamage" value="10">
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-6">
        <label for="targetElementDamage" class="form-label">å°å±¬å‚·%</label>
        <input type="number" class="form-control" id="targetElementDamage" value="10">
      </div>
      <div class="col-md-6">
        <label for="mainWeaponDamage" class="form-label">ä¸»æ­¦å™¨å‚·%</label>
        <input type="number" class="form-control" id="mainWeaponDamage" value="0">
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-6">
        <label for="levelDiff" class="form-label">ç­‰ç´šå·®ï¼ˆè‡ªèº« - æ•µäººï¼‰</label>
        <input type="number" class="form-control" id="levelDiff" value="5">
      </div>
      <div class="col-md-6">
        <label for="resist" class="form-label">å±¬æŠ—%</label>
        <input type="number" class="form-control" id="resist" value="0">
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-6">
        <label for="defReduction" class="form-label">é˜²ç¦¦æ¸›å‚·%</label>
        <input type="number" class="form-control" id="defReduction" value="0">
      </div>
      <div class="col-md-6">
        <label for="critDmg" class="form-label">çˆ†æ“Šå‚·å®³%</label>
        <input type="number" class="form-control" id="critDmg" value="130">
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-6">
        <label for="critResist" class="form-label">çˆ†æ“Šå‚·å®³æ¸›å°‘%</label>
        <input type="number" class="form-control" id="critResist" value="0">
      </div>
      <div class="col-md-6">
        <label for="targetBonus" class="form-label">é€ å‚·%</label>
        <input type="number" class="form-control" id="targetBonus" value="10">
      </div>
    </div>
    <div class="mb-3">
      <label for="finalReduce" class="form-label">å—åˆ°XXçš„å‚·å®³é™ä½ (æ¸›å‚·)%</label>
      <input type="number" class="form-control" id="finalReduce" value="0">
    </div>
  </form>
</div>

<div class="fixed-bottom-bar">
  <div class="container">
    <div class="row text-center">
      <div class="col-md-6 mb-2 mb-md-0">
        <h5 class="mb-1">ğŸ”¥ å¯¦éš›å‚·å®³ï¼ˆéçˆ†ï¼‰</h5>
        <div id="nonCritResult">å¹³å‡ï¼š0ï¼ˆ0 ~ 0ï¼‰</div>
      </div>
      <div class="col-md-6">
        <h5 class="mb-1">ğŸ’¥ å¯¦éš›å‚·å®³ï¼ˆçˆ†æ“Šï¼‰</h5>
        <div id="critResult">å¹³å‡ï¼š0ï¼ˆ0 ~ 0ï¼‰</div>
      </div>
    </div>
  </div>
</div>

<script>
let damageTable = {};

fetch('skilldmg_table.json')
  .then(response => response.json())
  .then(data => {
    damageTable = data;
    calculateDamage();
  });

const form = document.getElementById('damageForm');
form.addEventListener('input', calculateDamage);

function calculateDamage() {
  const get = id => parseFloat(document.getElementById(id).value) || 0;
  const setText = (id, value) => document.getElementById(id).textContent = value;

  const skillLevel = get('skillLevel');
  document.getElementById('baseSkillDamage').value = damageTable[skillLevel] || 0;

  const base = damageTable[skillLevel] || 0;
  const panel = get('panelDamage');
  const skillPanel = get('skillPanel');
  const dmgPct = get('damagePercent') / 100;
  const skillPct = get('skillDamagePercent') / 100;
  const tech = get('extraDamage') / 100;
  const elem = get('elementDamage') / 100;
  const elem2 = get('targetElementDamage') / 100;
  const weapon = get('mainWeaponDamage') / 100;
  const lvDiff = get('levelDiff') * 0.005;
  const resist = get('resist') / 100;
  const def = get('defReduction') / 100;
  const crit = (get('critDmg') - get('critResist')) / 100;
  const bonus = 1 + get('targetBonus') / 100;
  const reduce = 1 - get('finalReduce') / 100;

  let raw = (base * skillPct + panel * dmgPct + base * (tech + elem + elem2 + weapon) + base * lvDiff - base * resist - base * def);
  let nonCritAvg = raw * bonus * reduce;
  let critAvg = raw * crit * bonus * reduce;

  const fmt = n => Math.round(n).toLocaleString();
  setText('nonCritResult', `å¹³å‡ï¼š${fmt(nonCritAvg)}ï¼ˆ${fmt(nonCritAvg * 0.9)} ~ ${fmt(nonCritAvg * 1.1)})`);
  setText('critResult', `å¹³å‡ï¼š${fmt(critAvg)}ï¼ˆ${fmt(critAvg * 0.9)} ~ ${fmt(critAvg * 1.1)})`);
}
</script>

</body>
</html>
