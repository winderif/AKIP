<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>éŠæˆ²å‚·å®³è¨ˆç®—å™¨</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #121212;
      color: #f1f1f1;
    }
    .fixed-bottom-bar {
      position: sticky;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: #1f1f1f;
      border-top: 1px solid #333;
      padding: 1rem;
      z-index: 1030;
    }
    input.form-control {
      background-color: #2a2a2a;
      color: #fff;
      border: 1px solid #444;
    }
  </style>
</head>
<body>
<div class="container py-4">
  <h1 class="text-center mb-4">ğŸ§® éŠæˆ²å‚·å®³è¨ˆç®—å™¨</h1>

  <form id="damageForm">
    <div class="row mb-3">
      <div class="col-md-6">
        <label for="panelDamage" class="form-label">äººç‰©é¢æ¿å‚·å®³</label>        		
		<div class="input-group">
			<input type="number" class="form-control" id="panelDamage" value="74058">
			<button class="btn btn-outline-secondary" type="button" onclick="clearInput('panelDamage')">æ¸…é™¤</button>
		</div>
      </div>
	  <div class="col-md-6">
        <label for="skillPanel" class="form-label">æŠ€èƒ½é¢æ¿å‚·å®³</label>
		<div class="input-group">
			<input type="number" class="form-control" id="skillPanel" value="75555">
			<button class="btn btn-outline-secondary" type="button" onclick="clearInput('skillPanel')">æ¸…é™¤</button>
		</div>
      </div>      
    </div>
    <div class="row mb-3">
      <div class="col-md-6">
        <label for="skillLevel" class="form-label">æŠ€èƒ½ç­‰ç´š</label>
        <select id="skillLevel" class="form-select"></select>
      </div>
      <div class="col-md-6">
        <label for="baseSkillDamage" class="form-label">åŸºç¤æŠ€èƒ½å‚·å®³</label>
        <input type="number" readonly class="form-control" id="baseSkillDamage" readonly>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-6">
        <label for="damagePercent" class="form-label">å‚·å®³%</label>
		<div class="input-group">
			<input type="number" class="form-control" id="damagePercent" value="100">
			<button class="btn btn-outline-secondary" type="button" onclick="clearInput('damagePercent')">æ¸…é™¤</button>
		</div>
      </div>
      <div class="col-md-6">
        <label for="skillDamagePercent" class="form-label">æŠ€èƒ½å‚·å®³%</label>
		<div class="input-group">
			<input type="number" class="form-control" id="skillDamagePercent" value="100">
			<button class="btn btn-outline-secondary" type="button" onclick="clearInput('skillDamagePercent')">æ¸…é™¤</button>
		</div>
      </div>
    </div>
	<div class="row mb-3">
		<div class="col-md-6">
			<label for="damageHide" class="form-label">éš±è—è¡¨å‚·</label>
			<input type="number" readonly class="form-control" id="damageHide" value="">	
		</div>
		<div class="col-md-6">
		</div>
	</div>
    <div class="row mb-3">
      <div class="col-md-6">
        <label for="extraDamage" class="form-label">æŠ€å‚·% (æé«˜XXæŠ€èƒ½å‚·å®³%)</label>
		<div class="input-group">
			<input type="number" class="form-control" id="extraDamage" value="0">
			<button class="btn btn-outline-secondary" type="button" onclick="clearInput('extraDamage')">æ¸…é™¤</button>
		</div>
      </div>
      <div class="col-md-6">
        <label for="elementDamage" class="form-label">å±¬å‚·% (XXå±¬æ€§æŠ€èƒ½å‚·å®³æé«˜%)</label>
		<div class="input-group">
			<input type="number" class="form-control" id="elementDamage" value="10">
			<button class="btn btn-outline-secondary" type="button" onclick="clearInput('elementDamage')">æ¸…é™¤</button>
		</div>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-6">
        <label for="targetElementDamage" class="form-label">å°å±¬å‚·% (å°XXå±¬æ€§çš„å‚·å®³æé«˜%)</label>
		<div class="input-group">
			<input type="number" class="form-control" id="targetElementDamage" value="10">
			<button class="btn btn-outline-secondary" type="button" onclick="clearInput('targetElementDamage')">æ¸…é™¤</button>
		</div>
      </div>
      <div class="col-md-6">
        <label for="mainWeaponDamage" class="form-label">ä¸»æ­¦å™¨å‚·% (ä¸»æ­¦å™¨çš„å‚·å®³æé«˜%)</label>
		<div class="input-group">
			<input type="number" class="form-control" id="mainWeaponDamage" value="0">
			<button class="btn btn-outline-secondary" type="button" onclick="clearInput('mainWeaponDamage')">æ¸…é™¤</button>
		</div>
      </div>
    </div>
	<div class="form-check mb-3">
      <input class="form-check-input" type="checkbox" id="weaponElementMatch">
      <label class="form-check-label" for="weaponElementMatch">æ­¦å™¨å±¬æ€§åŒæŠ€èƒ½å±¬æ€§</label>
    </div>
    <div class="form-check mb-3">
      <input class="form-check-input" type="checkbox" id="skillElementMatch">
      <label class="form-check-label" for="skillElementMatch">æŠ€èƒ½å±¬æ€§åŒæ•µäººå±¬æ€§</label>
    </div>
	<div class="row mb-3">
	  <div class="col-md-6">
        <label for="levelDiff" class="form-label">ç­‰ç´šå·®ï¼ˆè‡ªèº« - æ•µäººï¼‰</label>
        <select id="levelDiff" class="form-select"></select>
      </div>
	  <div class="col-md-6">        
      </div>
	</div>
    <div class="row mb-3">      
      <div class="col-md-6">
        <label for="resist" class="form-label">å±¬æŠ—%</label>
		<div class="input-group">
			<input type="number" class="form-control" id="resist" value="0">
			<button class="btn btn-outline-secondary" type="button" onclick="clearInput('resist')">æ¸…é™¤</button>
		</div>
      </div>
	  <div class="col-md-6">
        <label for="defReduction" class="form-label">é˜²ç¦¦æ¸›å‚·%</label>
		<div class="input-group">
			<input type="number" class="form-control" id="defReduction" value="0">
			<button class="btn btn-outline-secondary" type="button" onclick="clearInput('defReduction')">æ¸…é™¤</button>
		</div>
      </div>
    </div>
    <div class="row mb-3">      
      <div class="col-md-6">
        <label for="critDmg" class="form-label">çˆ†æ“Šå‚·å®³%</label>
		<div class="input-group">
			<input type="number" class="form-control" id="critDmg" value="130">
			<button class="btn btn-outline-secondary" type="button" onclick="clearInput('critDmg')">æ¸…é™¤</button>
		</div>
      </div>
	  <div class="col-md-6">
        <label for="critResist" class="form-label">å—åˆ°çˆ†æ“Šå‚·å®³é™ä½%</label>
		<div class="input-group">
			<input type="number" class="form-control" id="critResist" value="0">
			<button class="btn btn-outline-secondary" type="button" onclick="clearInput('critResist')">æ¸…é™¤</button>
		</div>
      </div>
    </div>
    <div class="row mb-3">      
      <div class="col-md-6">
        <label for="targetBonus" class="form-label">é€ å‚·% (å°XXç›®æ¨™çš„å‚·å®³æé«˜%)</label>
		<div class="input-group">
			<input type="number" class="form-control" id="targetBonus" value="10">
			<button class="btn btn-outline-secondary" type="button" onclick="clearInput('targetBonus')">æ¸…é™¤</button>
		</div>
      </div>
	  <div class="col-md-6">
		<label for="finalReduce" class="form-label">æ¸›å‚·% (å—åˆ°XXçš„å‚·å®³é™ä½%)</label>
		<div class="input-group">
			<input type="number" class="form-control" id="finalReduce" value="0">
			<button class="btn btn-outline-secondary" type="button" onclick="clearInput('finalReduce')">æ¸…é™¤</button>
		</div>
	  </div>
    </div>
  </form>
</div>

<div class="fixed-bottom-bar">
  <div class="container">
    <div class="row text-center">
      <div class="col-md-6 mb-2 mb-md-0">
        <h5 class="mb-1">ğŸ”¥ å¯¦éš›å‚·å®³ï¼ˆéçˆ†ï¼‰</h5>
        <div id="nonCritResult">å¹³å‡ï¼š0ï¼ˆ0 ~ 0ï¼‰</div>
      </div>
      <div class="col-md-6">
        <h5 class="mb-1">ğŸ’¥ å¯¦éš›å‚·å®³ï¼ˆçˆ†æ“Šï¼‰</h5>
        <div id="critResult">å¹³å‡ï¼š0ï¼ˆ0 ~ 0ï¼‰</div>
      </div>
    </div>
  </div>
</div>

<script>
let damageTable = {};

fetch('skilldmg_table.json')
  .then(response => response.json())
  .then(data => {
    damageTable = data;    
	populateSelects();
    calculateDamage();
  });

function populateSelects() {
  const skillLevelSelect = document.getElementById('skillLevel');
  for (let i = 48; i <= 180; i++) {
    const option = document.createElement('option');
    option.value = option.textContent = i;
    skillLevelSelect.appendChild(option);
  }

  const levelDiffSelect = document.getElementById('levelDiff');
  for (let i = 20; i >= -20; i--) {
    const option = document.createElement('option');
    option.value = option.textContent = i;
    levelDiffSelect.appendChild(option);
  }
}

function clearInput(id) {
  document.getElementById(id).value = '';
  calculateDamage();
}

const form = document.getElementById('damageForm');
form.addEventListener('input', calculateDamage);

function calculateDamage() {
  const get = id => parseFloat(document.getElementById(id).value) || 0;
  const getCheckbox = id => document.getElementById(id).checked;
  const setText = (id, value) => document.getElementById(id).textContent = value;
   
  const skillLevel = get('skillLevel');
  document.getElementById('baseSkillDamage').value = damageTable[skillLevel] || 0;  

  const base = damageTable[skillLevel] || 0;
  const panel = get('panelDamage');
  const skillPanel = get('skillPanel');
  const dmgPct = get('damagePercent') / 100;
  const skillPct = get('skillDamagePercent') / 100;
  const tech = get('extraDamage') / 100;
  const elem = get('elementDamage') / 100;
  const elem2 = get('targetElementDamage') / 100;
  const weapon = get('mainWeaponDamage') / 100;
  const weleMatch = getCheckbox('weaponElementMatch') ? 0.2 : 0;
  const resistMatch = getCheckbox('skillElementMatch') ? 0.25 : 0;
  const lvDiff = get('levelDiff') * 0.005;
  const resist = get('resist') / 100;
  const def = get('defReduction') / 100;
  const crit = (get('critDmg') - get('critResist')) / 100;
  const bonus = 1 + get('targetBonus') / 100;
  const reduce = 1 - get('finalReduce') / 100;
  
  document.getElementById('damageHide').value = (skillPanel - (base * skillPct)) / dmgPct;
  let damageHide = get('damageHide');

  let raw = (base * skillPct + damageHide * (dmgPct + tech + elem + elem2 + weapon + weleMatch + lvDiff - resist - def - resistMatch));
  let nonCritAvg = raw * bonus * reduce;
  let critAvg = raw * crit * bonus * reduce;

  const fmt = n => Math.round(n).toLocaleString();
  setText('nonCritResult', `å¹³å‡ï¼š${fmt(nonCritAvg)}ï¼ˆ${fmt(nonCritAvg * 0.9)} ~ ${fmt(nonCritAvg * 1.1)})`);
  setText('critResult', `å¹³å‡ï¼š${fmt(critAvg)}ï¼ˆ${fmt(critAvg * 0.9)} ~ ${fmt(critAvg * 1.1)})`);
}
</script>

</body>
</html>
